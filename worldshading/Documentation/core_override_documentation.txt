
======================================================================
ERPNext Core Modification Documentation - ws overrides
======================================================================

All modifications made directly in the ERPNext core code are minimal, intentional, and controlled.
Each change is clearly marked using the comment tag:
==============
# ws overrides
==============
To quickly locate all core customizations, simply search for "ws overrides" within the ERPNext codebase.
This ensures transparency, easy auditing, and safer future upgrades or migrations.


====
1,
====
ğŸ“ File Modified:
Path: frappe-bench/apps/erpnext/erpnext/stock/reorder_item.py

ğŸ”§ Function Modified:
_reorder_item()

ğŸ› ï¸ Change Summary:
Added a safety check to skip Item Reorder rows with unsupported Material Request types like 'Repack' or 'Production'.

âœ… Added:
    if d.material_request_type not in material_requests:
        continue  # skip custom types like Repack or Production


ğŸ“… Date of Change:
2025-04-14




====
2,
====
ğŸ“ File Modified:
Path: frappe-bench/apps/erpnext/erpnext/stock/stock_balance.py

ğŸ”§ Function Modified:
get_indented_qty(item_code, warehouse)

ğŸ› ï¸ Change Summary:
Added 'Repack' and 'Production' to the list of allowed Material Request types
in the SQL query that calculates `inward_qty` for requested_qty calculation.
âœ… Added: mr.material_request_type in ('Purchase', 'Manufacture', 'Customer Provided', 'Material Transfer','Repack','Production')

ğŸ§  Reason:
By default, ERPNext only considers Material Requests of types:
'Purchase', 'Manufacture', 'Customer Provided', and 'Material Transfer'
for updating the `requested_qty` in the `tabBin` table.
Since we use custom scheduler logic to generate Material Requests of type
'Repack' and 'Production', they were not being reflected in the projected
quantity calculations. This caused the system to keep triggering new
Material Requests even when valid ones already existed.

ğŸ“… Date of Change:
2025-04-16

 
====
3,
====

ğŸ“ File Modified:
Path: frappe-bench/apps/erpnext/erpnext/stock/doctype/material_request/material_request.py

ğŸ”§ Function Modified:
def validate(self):

ğŸ› ï¸ Change Summary:
Added support for 4 new custom workflow statuses (Repacked, Produced, Partially Repacked, Partially Produced) to the allowed status validation inside the validate() method.


# ğŸ” Before:
validate_status(self.status, ["Draft", "Submitted", "Stopped", "Cancelled", "Pending", "Partially Ordered", "Ordered", "Issued", "Transferred", "Received", "Manufactured"])

# âœ… After:
validate_status(self.status, [
    "Draft", "Submitted", "Stopped", "Cancelled", "Pending",
    "Partially Ordered", "Ordered", "Issued", "Transferred", "Received",
    "Repacked", "Produced", "Partially Repacked", "Partially Produced"
])

ğŸ§  Reason:
ERPNext by default validates only predefined statuses for Material Requests. Since we introduced two new Material Request types (Repack, Production) with their own lifecycle statuses, we needed to allow these in the validation to prevent Invalid Status errors during save or submit.

ğŸ“… Date of Change:
2025-05-15



====
4,
====


ğŸ“ File Modified:
Path: frappe-bench/apps/erpnext/erpnext/stock/doctype/material_request/material_request.py


ğŸ”§ Function Modified:
update_completed_qty(self, mr_items=None, update_modified=True)

ğŸ› ï¸ Change Summary:
Included support for Repack and Production in the condition that determines which Stock Entry types should contribute to ordered_qty.


# ğŸ” Before:
if self.material_request_type in ("Material Issue", "Material Transfer", "Customer Provided"):

# âœ… After:
if self.material_request_type in ("Material Issue", "Material Transfer", "Customer Provided", "Repack", "Production"):
This ensures Stock Entries for Repack and Production are also considered when calculating fulfillment percentages for the Material Request.

ğŸ§  Reason:
ERPNext originally does not consider Repack and Production types when calculating per_ordered. This caused the status to remain â€œPendingâ€ or â€œPartially Orderedâ€ even after all to_items were fulfilled. Adding these types ensures accurate progress tracking for custom workflows.

ğŸ“… Date of Change:
2025-05-15


====
5,
====

ğŸ“ File Modified:
Path:
frappe-bench/apps/erpnext/erpnext/selling/doctype/sales_order/sales_order.py

ğŸ”§ Lines Commented:
# from erpnext.stock.doctype.packed_item.packed_item import make_packing_list
# make_packing_list(self)

ğŸ› ï¸ Change Summary:
ğŸš« Disabled automatic packing list generation by commenting out:


This prevents ERPNext from auto-generating packed items when saving a Sales Order.



====
6,
====

ğŸ“ File Modified:
Path:
frappe-bench/apps/erpnext/erpnext/stock/doctype/delivery_note/delivery_note.py

ğŸ”§ Function Modified:
def validate(self):

ğŸ› ï¸ Change Summary:
Added a conditional check to control automatic packing list generation
based on a custom checkbox field `custom_project_logic`.

ğŸš« Modified Logic:
Disabled ERPNextâ€™s default behavior of always generating packed items
during Delivery Note validation, unless explicitly allowed.

# ğŸ” Before:
from erpnext.stock.doctype.packed_item.packed_item import make_packing_list
make_packing_list(self)

# âœ… After (ws overrides):
# added custom project logic check - ws overrides
if not self.get("custom_project_logic"):
    from erpnext.stock.doctype.packed_item.packed_item import make_packing_list
    make_packing_list(self)

ğŸ§  Reason:
In custom project-based workflows, packing logic is handled manually or
through custom automation (e.g. split delivery notes, parent vs packed
items handling). 





